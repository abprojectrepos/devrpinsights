<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="1/30/2019 1:46:31 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="NCS-110119GM22"
  DTS:CreatorName="NCS\P0500388"
  DTS:DelayValidation="True"
  DTS:DTSID="{6C5AACFD-CF99-4F2A-9089-B591687FBCD8}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.0900.40"
  DTS:LocaleID="18441"
  DTS:ObjectName="DM_ACE_CET_ENROLMENT"
  DTS:PackageType="5"
  DTS:VersionBuild="138"
  DTS:VersionGUID="{DCF633A5-8774-4612-A351-CEFC2C3A6BEA}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[DW]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{4575CC56-A24D-48B8-B381-3262FCA2484A}"
      DTS:ObjectName="DW">
      <DTS:PropertyExpression
        DTS:Name="InitialCatalog">@[$Project::DW_Initial_Catalog]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="ServerName">@[$Project::ServerName]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="UserName">@[$Project::UserName]</DTS:PropertyExpression>
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=172.22.2.38;User ID=svc-dw-prod-etl;Initial Catalog=RPDW_PRD;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdt5ruCW0f0SpuyAxH6oiUQAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAAA/FeOO07SncClx8fZWs9AwAAAAAASAAACgAAAAEAAAAL6Ay6JkQcS1St0E7Odc4/EYAAAAZumoxs9CwcsX/jmvoz6/GDOF7tnFke41FAAAAJo3/6SO5/QL13q++h1gLI7YIt1c</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[ErrorLog]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
      DTS:ObjectName="ErrorLog">
      <DTS:PropertyExpression
        DTS:Name="InitialCatalog">@[$Project::DW_Initial_Catalog]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="ServerName">@[$Project::ServerName]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="UserName">@[$Project::UserName]</DTS:PropertyExpression>
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=172.22.2.38;User ID=svc-dw-prod-etl;Initial Catalog=RPDW_PRD;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdt5ruCW0f0SpuyAxH6oiUQAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAACOrT0eXyBb7ToGeBsrqV7VAAAAAASAAACgAAAAEAAAANOvuMoi0xvfuos+lsbJ8MQYAAAAhNcrZJBYuVIRWzC5OJidUIdH7QKq3cGoFAAAAAFiSsm78EYrbDzDmkQiB4I6rMod</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{12D4DE0B-4F8A-42F2-80E3-5842666398A0}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="Duplicate_Check">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{D21D4850-17EE-444F-B184-6F648EC242C4}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="Job_name">
      <DTS:VariableValue
        DTS:DataType="8">DM_ACE_CET_ENROLMENT</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{DAE934EE-7014-4318-AC9C-52F3F3757A9B}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="Job_Status">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{D9F01093-72C8-47E5-8E57-EB78327F2B3C}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="JOB_STATUS_ID">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{C1A7DF6D-97BC-42F5-85B0-0EBDA8F43D82}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="Mandatory_constraint_Check">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{45EA70DE-21E4-4095-9505-FC7E9DB72646}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="Process_date">
      <DTS:VariableValue
        DTS:DataType="7">2/1/2019 2:58:47 PM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B78905F1-2FCC-4657-AF23-EC803042EB32}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="SourceTable">
      <DTS:VariableValue
        DTS:DataType="8">DW_STUDENT_ENROLMENT</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{5EF238F9-ACC7-4E0A-BB87-C2538BC2F6C6}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;BEGIN TRANSACTION&#xA;BEGIN TRY&#xA;--------------------------------------&#xA;DECLARE @jobstatusid varchar(5)&#xA;select @jobstatusid=&quot;+ (DT_STR, 5,1252) @[User::JOB_STATUS_ID] +&quot;&#xA;&#xA;DELETE FROM [dbo].[DM_ACE_CET_ENROLMENT]&#xA;&#xA;-------&#xA;INSERT INTO DM_ACE_CET_ENROLMENT&#xA;&#xA;SELECT * FROM (&#xA;&#x9;SELECT &#xA;&#x9;&#x9; pt.School_Centre as Department&#xA;&#x9;&#x9;,c.Descr as Department_Descr&#xA;&#x9;&#x9;--,pt.Prog_Code+' - '+pt.Prog_Descr  as Programme&#xA;&#x9;&#x9;,b.Main_Prog+' - '+pt.Prog_Descr   as Programme&#xA;&#x9;&#x9;,b.Main_Qual_Type as Programme_Qual_Type&#xA;&#x9;&#x9;,b.Programme_Run_Title as Programme_Run_Title&#xA;&#x9;&#x9;--,NULL as Programme_Run_Title&#xA;&#x9;&#x9;,b.Certificate_Qual_Type&#xA;&#x9;&#x9;,b.Certificate_Run_Title&#xA;&#x9;&#x9;,b.Admit_Term as Admit_Term&#xA;&#x9;&#x9;,b.boe_Term as BOE_Term&#xA;&#x9;&#x9;,b.Module_ID as Module_ID&#xA;&#x9;&#x9;,b.Module_Code as Module_Code&#xA;&#x9;&#x9;,d.Module_Title as Module_Description&#xA;&#x9;&#x9;,b.Mod_School as Module_Owner&#xA;&#x9;&#x9;,e.Descr as Module_Owner_Descr&#xA;&#x9;&#x9;,ISNULL(b.Class_Label,'NA') as Class&#xA;&#x9;&#x9;,b.Class_Start_Date as Class_Date&#xA;&#x9;&#x9;,CASE WHEN month(f.Class_Start_Date)&gt;=4 then 'AY'+CAST(Year(f.Class_Start_Date) as varchar)&#xA;&#x9;&#x9;ELSE 'AY'+ Cast(Year(f.Class_Start_Date)-1 as varchar)END as Academic_Year&#xA;&#x9;&#x9;,ISNULL(cast(f.Class_Meeting_Number as varchar),'NA') as Class_Meeting_Number&#xA;&#x9;&#x9;,RIGHT('0'+CAST(DATEPART(hour, f.Meeting_Time_Start) as varchar(2)),2) + ':' +&#xA;&#x9;&#x9;&#x9;   RIGHT('0'+CAST(DATEPART(minute, f.Meeting_Time_Start)as varchar(2)),2) +':'+&#xA;&#x9;&#x9;&#x9;   RIGHT('0'+CAST(DATEPART(SECOND, f.Meeting_Time_Start)as varchar(2)),2) as Class_Start_Time&#xA;&#x9;&#x9;,RIGHT('0'+CAST(DATEPART(hour, f.Meeting_Time_End) as varchar(2)),2) + ':' +&#xA;&#x9;&#x9;&#x9;   RIGHT('0'+CAST(DATEPART(minute, f.Meeting_Time_End)as varchar(2)),2) +':'+&#xA;&#x9;&#x9;&#x9;   RIGHT('0'+CAST(DATEPART(SECOND, f.Meeting_Time_End)as varchar(2)),2) as Class_End_Time&#xA;&#x9;&#x9;,cast(Duration as decimal(5,2)) as Class_Duration_In_Hours&#xA;&#x9;&#x9;,b.Student_ID&#xA;&#x9;&#x9;,b.Lecturer_ID&#xA;&#x9;&#x9;,b.Lecturer_Name&#xA;&#x9;&#x9;,Getdate() as created_on&#xA;&#x9;&#x9;,Getdate()  as modified_on &#xA;&#x9;from (&#xA;&#x9;&#x9;select &#xA;&#x9;&#x9;&#x9;A.*&#xA;&#x9;&#x9;&#x9;,a.Course_Title as Certificate_Run_Title&#xA;&#x9;&#x9;&#x9;,a.Qual_Type as Certificate_Qual_Type&#xA;&#x9;&#x9;&#x9;,Main_Qual_Type as Programme_Qual_Type&#xA;&#x9;&#x9;&#x9;,rs.Course_Title Programme_Run_Title&#xA;&#x9;&#x9;&#x9;,ROW_NUMBER()over(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;partition by a.module_code,a.class_label,a.class_nbr,a.qual_type, a.Programme,student_id  &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;order by a.run_number desc) rn&#xA;&#x9;&#x9;from (&#xA;&#x9;&#x9;&#x9;&#x9;select &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;active_cet.*&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,rs.Course_Title&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,rs.Programme_Descr&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,rs.Programme as Prog_Run_Setup &#xA;&#x9;&#x9;&#x9;&#x9;from (&#xA;------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;select &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;enrol.*&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,Main_Prog1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,Student_Status&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,Specialisatn&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,CET_Run_Number&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,Admit_Term &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;from (&#xA;SELECT [Class_Label]&#xA;      ,[Student_ID]&#xA;      ,[Qual_Type]&#xA;      ,[Qual_Type_Descr]&#xA;      ,[Institution]&#xA;      ,[BOE_Term]&#xA;      ,[Class_Nbr]&#xA;      ,[Module_Component]&#xA;      ,[Main_Qual_Type]&#xA;      ,[Run_Number]&#xA;      ,[Programme]&#xA;      ,[Mod_Cohort]&#xA;      ,[Mod_School]&#xA;      ,[Acad_day]&#xA;      ,[Module_ID]&#xA;      ,[Module_Code]&#xA;      ,[Facility_ID]&#xA;      ,[Lecturer_ID]&#xA;      ,[Lecturer_Role]&#xA;      ,[Lecturer_Name]&#xA;      ,[Instructor_Assign_Seq]&#xA;      ,[Class_Capacity]&#xA;      ,[Class_Section]&#xA;      ,[Session_Code]&#xA;      ,[Course_Offer_Nbr]&#xA;      ,[Class_Start_Date]&#xA;      ,[Class_End_Date]&#xA;      ,[CREATED_ON]&#xA;      ,[MODIFIED_ON]&#xA;      ,[Main_Prog]&#xA;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY [Class_Label]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Student_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[BOE_Term]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Class_Nbr]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_Component]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Main_Qual_Type]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_Code]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Lecturer_ID]&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ORDER BY Run_Number) smol_run_num&#xA;&#x9;&#x9;&#x9;FROM [RPDW_PRD].[dbo].[DW_STUDENT_ENROLMENT]&#xA;&#x9;&#x9;&#x9;where (Qual_Type like 'MC%' or Qual_Type like 'PDC%') and trim(Main_Qual_Type)&lt;&gt;''&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;) enrol,&#xA;&#x9;(&#xA;&#x9;&#x9;select &#xA;&#x9;&#x9;&#x9;Student_Id&#xA;&#x9;&#x9;&#x9;,Admit_Term&#xA;&#x9;&#x9;&#x9;,Qual_type&#xA;&#x9;&#x9;&#x9;,Prog as Main_Prog1&#xA;&#x9;&#x9;&#x9;,Reqmt_Term&#xA;&#x9;&#x9;&#x9;,Effective_Date&#xA;&#x9;&#x9;&#x9;,Effective_Seq&#xA;&#x9;&#x9;&#x9;,Student_Status&#xA;&#x9;&#x9;&#x9;,Prog_Action&#xA;&#x9;&#x9;&#x9;,Expected_Grad_Term&#xA;&#x9;&#x9;&#x9;,Specialisatn&#xA;&#x9;&#x9;&#x9;,CET_Run_Number &#xA;&#x9;&#x9;from (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;Student_Id&#xA;&#x9;&#x9;,Admit_Term&#xA;&#x9;&#x9;,Qual_type&#xA;&#x9;&#x9;,Prog&#xA;&#x9;&#x9;,Reqmt_Term&#xA;&#x9;&#x9;,Effective_Date&#xA;&#x9;&#x9;,Effective_Seq&#xA;&#x9;&#x9;,Student_Status&#xA;&#x9;&#x9;,Prog_Action&#xA;&#x9;&#x9;,Expected_Grad_Term&#xA;&#x9;&#x9;,Specialisatn&#xA;&#x9;&#x9;,CET_Run_Number&#xA;&#x9;&#x9;,ROW_NUMBER() OVER ( PARTITION BY Student_Id, Prog&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ORDER BY Effective_Date DESC, Effective_Seq DESC) rownum&#xA;&#x9;FROM DW_STUDENT_MOVEMENT&#xA;&#x9;WHERE Qual_Type not in ('DPFT','PFP','STFF')&#xA;&#x9;&#x9;AND (Student_Status = 'AC' AND Prog_Action = 'MATR'&#xA;&#x9;&#x9;OR (Student_Status = 'CM' AND Prog_Action = 'COMP'))&#xA;&#x9;) a where a.rownum=1&#xA;) mov&#xA;where mov.Student_Id = enrol.Student_ID&#xA;&#x9;AND mov.Qual_Type = enrol.Main_Qual_Type&#xA;&#x9;AND mov.Student_Status = 'AC'&#xA;&#x9;AND enrol.BOE_Term &gt;= mov.Admit_Term&#xA;&#x9;AND enrol.smol_run_num=1&#xA;UNION &#xA;select &#xA;&#x9;enrol.*&#xA;&#x9;,Main_Prog1&#xA;&#x9;,Student_Status&#xA;&#x9;,Specialisatn&#xA;&#x9;,CET_Run_Number&#xA;&#x9;,Admit_Term&#xA;from&#xA;(&#xA;SELECT [Class_Label]&#xA;      ,[Student_ID]&#xA;      ,[Qual_Type]&#xA;      ,[Qual_Type_Descr]&#xA;      ,[Institution]&#xA;      ,[BOE_Term]&#xA;      ,[Class_Nbr]&#xA;      ,[Module_Component]&#xA;      ,[Main_Qual_Type]&#xA;      ,[Run_Number]&#xA;      ,[Programme]&#xA;      ,[Mod_Cohort]&#xA;      ,[Mod_School]&#xA;      ,[Acad_day]&#xA;      ,[Module_ID]&#xA;      ,[Module_Code]&#xA;      ,[Facility_ID]&#xA;      ,[Lecturer_ID]&#xA;      ,[Lecturer_Role]&#xA;      ,[Lecturer_Name]&#xA;      ,[Instructor_Assign_Seq]&#xA;      ,[Class_Capacity]&#xA;      ,[Class_Section]&#xA;      ,[Session_Code]&#xA;      ,[Course_Offer_Nbr]&#xA;      ,[Class_Start_Date]&#xA;      ,[Class_End_Date]&#xA;      ,[CREATED_ON]&#xA;      ,[MODIFIED_ON]&#xA;      ,[Main_Prog]&#xA;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY [Class_Label]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Student_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[BOE_Term]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Class_Nbr]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_Component]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Main_Qual_Type]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Module_Code]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Lecturer_ID]&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ORDER BY Run_Number) smol_run_num&#xA;&#x9;&#x9;&#x9;FROM [RPDW_PRD].[dbo].[DW_STUDENT_ENROLMENT]&#xA;&#x9;&#x9;&#x9;where (Qual_Type like 'MC%' or Qual_Type like 'PDC%') and trim(Main_Qual_Type)&lt;&gt;'') enrol,&#xA;(select Student_Id, Admit_Term, Qual_type, Prog as Main_Prog1, Reqmt_Term, Effective_Date, Effective_Seq, Student_Status, Prog_Action, Expected_Grad_Term,Specialisatn, CET_Run_Number &#xA;from (&#xA;&#x9;SELECT Student_Id, Admit_Term, Qual_type, Prog, Reqmt_Term, Effective_Date, Effective_Seq, Student_Status, Prog_Action, Expected_Grad_Term,Specialisatn, CET_Run_Number,&#xA;&#x9;  ROW_NUMBER() OVER (&#xA;&#x9;   PARTITION BY Student_Id, Prog&#xA;   ORDER BY Effective_Date DESC, Effective_Seq DESC) rownum&#xA;  FROM DW_STUDENT_MOVEMENT&#xA;  WHERE Qual_Type not in ('DPFT','PFP','STFF')&#xA;AND (Student_Status = 'AC' AND Prog_Action = 'MATR'&#xA;OR (Student_Status = 'CM' AND Prog_Action = 'COMP'))&#xA;) a where a.rownum=1&#xA;) mov&#xA;where mov.Student_Id = enrol.Student_ID&#xA;AND mov.Qual_Type = enrol.Main_Qual_Type&#xA;AND mov.Student_Status = 'CM'&#xA;AND enrol.BOE_Term &gt;= mov.Admit_Term&#xA;AND enrol.BOE_Term &lt;= mov.Expected_Grad_Term&#xA;AND enrol.smol_run_num=1&#xA;------------------------------------------------------------&#xA;)active_cet&#xA;left join (select distinct Specialisatn, Qual_type, Programme, Programme_Descr, Student_Attribute, Acad_Term, Run_Number, Course_Title, Course_Start_Date, Course_End_Date, &#xA;Date_Closed, Cert_Qual_Type, Cert_Programme, Cert_Programme_Descr, Cert_Specialisatn, Cert_Run_Number &#xA;from DW_CET_RUN_SETUP) rs&#xA; on  active_cet.programme=rs.programme and active_cet.qual_type=rs.qual_type --and active_cet.Admit_Term=rs.Acad_Term &#xA; and active_cet.Run_Number=rs.Run_Number&#xA;&#xA;  ) A --Get_Sub_Qual_Type_Course_Title as A&#xA;  left join (&#xA;&#x9;&#x9;&#x9;select distinct &#xA;&#x9;&#x9;&#x9;&#x9;Specialisatn&#xA;&#x9;&#x9;&#x9;&#x9;,Qual_type&#xA;&#x9;&#x9;&#x9;&#x9;,Programme&#xA;&#x9;&#x9;&#x9;&#x9;,Programme_Descr&#xA;&#x9;&#x9;&#x9;&#x9;,Student_Attribute&#xA;&#x9;&#x9;&#x9;&#x9;,Acad_Term&#xA;&#x9;&#x9;&#x9;&#x9;,Run_Number&#xA;&#x9;&#x9;&#x9;&#x9;,Course_Title&#xA;&#x9;&#x9;&#x9;&#x9;,Course_Start_Date&#xA;&#x9;&#x9;&#x9;&#x9;,Course_End_Date&#xA;&#x9;&#x9;&#x9;&#x9;,Date_Closed&#xA;&#x9;&#x9;&#x9;&#x9;,Cert_Qual_Type&#xA;&#x9;&#x9;&#x9;&#x9;,Cert_Programme&#xA;&#x9;&#x9;&#x9;&#x9;,Cert_Programme_Descr&#xA;&#x9;&#x9;&#x9;&#x9;,Cert_Specialisatn&#xA;&#x9;&#x9;&#x9;&#x9;,Cert_Run_Number &#xA;&#x9;&#x9;&#x9;from DW_CET_RUN_SETUP) rs&#xA;on  a.Main_Prog=rs.programme and a.Main_Qual_Type=rs.qual_type --and active_cet.Admit_Term=rs.Acad_Term &#xA; --and a.Specialisatn=rs.Specialisatn&#xA; and a.CET_Run_Number=rs.Run_Number&#xA; and a.Qual_Type=rs.Cert_Qual_Type&#xA;) b&#xA;&#xA; LEFT JOIN (select  Prog_Code,Prog_Descr,School_Centre from dbo.DW_CET_PROGRAMME a1&#xA;&#x9;&#x9; where a1.Effective_Date in (select max(b1.Effective_Date) from dbo.DW_CET_PROGRAMME b1&#xA;&#x9;&#x9; where b1.Prog_Code=a1.PROG_CODE))  pt ON  b.Main_Prog=pt.Prog_Code--Get_Main_CET_Program&#xA;&#xA;LEFT JOIN DW_EXT_DEPARTMENT c ON pt.School_Centre=c.Department&#xA;Left Join (select  distinct ModuleID,Module_Code,Module_Title from dbo.DW_MODULE a1&#xA;&#x9;&#x9; where a1.Effective_Date in (select max(b1.Effective_Date) from dbo.DW_MODULE b1&#xA;&#x9;&#x9; where b1.ModuleID=a1.ModuleID)) d on d.ModuleID=b.Module_ID &#xA;LEFT JOIN DW_EXT_DEPARTMENT e ON e.Department=b.Mod_School&#xA;LEFT JOIN (&#xA;&#x9;&#x9;SELECT DISTINCT  &#xA;&#x9;&#x9;&#x9;Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, class_Number,&#xA;&#x9;&#x9;&#x9;MIN(Meeting_Time_Start) AS Meeting_Time_Start, &#xA;&#x9;&#x9;&#x9;MAX(Meeting_Time_End) AS Meeting_Time_End,&#xA;&#x9;&#x9;&#x9;SUM(CAST(DATEDIFF(minute, Meeting_Time_Start, Meeting_Time_End) AS decimal)/60.0) AS Duration&#xA;&#x9;&#x9;FROM (&#xA;&#x9;&#x9;&#x9;SELECT Lecturer_Id, Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, Meeting_Time_Start, Meeting_Time_End,class_Number,&#xA;&#x9;&#x9;&#x9;&#x9;ROW_NUMBER() OVER (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;   PARTITION BY Module_Id, Module_Code, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, Meeting_Time_Start, Meeting_Time_End,class_Number&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;   ORDER BY Instructor_Assign_Seq, Meeting_Time_Start desc) AS rownum&#xA;&#x9;&#x9;   FROM DW_STUDENT_CLASS_SCHEDULE&#xA;&#x9;&#x9;   WHERE Qual_Type not in ('DPFT','PFP','STFF')&#xA;&#x9;&#x9;  -- and Class_Label='ME-6-E3209C-A' &#xA;&#x9;&#x9;  -- and Class_Meeting_Number=1 &#xA;&#x9;&#x9;   and trim(Lecturer_Id)&lt;&gt;''&#xA;       --OR Qual_Type LIKE 'MC%'&#xA;       --OR Qual_Type LIKE 'PDC%'))sc&#xA;&#x9;   )sc&#xA;WHERE sc.rownum = 1&#xA;GROUP BY Lecturer_Id, Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number,class_Number)F&#xA;ON f.Class_Number=b.Class_Nbr and f.Module_Id=b.Module_ID and f.Class_Label=b.Class_Label &#xA;and f.Class_Start_Date=b.Class_Start_Date&#xA;where rn=1)&#xA;a where Class_Meeting_Number &lt;&gt;'NA'&#xA;;&#xA;&#xA;&#xA;  COMMIT TRANSACTION&#xA;END TRY&#xA;&#xA;BEGIN CATCH&#xA;ROLLBACK TRANSACTION&#xA;&#xA;  INSERT INTO ETL_ERROR_LOG(JOB_STATUS_ID,ERROR_RECORD,created_on)&#xA;  SELECT   &#xA;         CAST(@jobstatusid as int) as JOB_STATUS_ID&#xA;        ,ERROR_MESSAGE() AS ErrorMessage&#xA;&#x9;&#x9;,getdate()  as created_on&#xA;END CATCH  &#xA;GO&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="SQL_DM_Load">
      <DTS:VariableValue
        DTS:DataType="8">BEGIN TRANSACTION
BEGIN TRY
--------------------------------------
DECLARE @jobstatusid varchar(5)
select @jobstatusid=0

DELETE FROM [dbo].[DM_ACE_CET_ENROLMENT]

-------
INSERT INTO DM_ACE_CET_ENROLMENT

SELECT * FROM (
	SELECT 
		 pt.School_Centre as Department
		,c.Descr as Department_Descr
		--,pt.Prog_Code+' - '+pt.Prog_Descr  as Programme
		,b.Main_Prog+' - '+pt.Prog_Descr   as Programme
		,b.Main_Qual_Type as Programme_Qual_Type
		,b.Programme_Run_Title as Programme_Run_Title
		--,NULL as Programme_Run_Title
		,b.Certificate_Qual_Type
		,b.Certificate_Run_Title
		,b.Admit_Term as Admit_Term
		,b.boe_Term as BOE_Term
		,b.Module_ID as Module_ID
		,b.Module_Code as Module_Code
		,d.Module_Title as Module_Description
		,b.Mod_School as Module_Owner
		,e.Descr as Module_Owner_Descr
		,ISNULL(b.Class_Label,'NA') as Class
		,b.Class_Start_Date as Class_Date
		,CASE WHEN month(f.Class_Start_Date)&gt;=4 then 'AY'+CAST(Year(f.Class_Start_Date) as varchar)
		ELSE 'AY'+ Cast(Year(f.Class_Start_Date)-1 as varchar)END as Academic_Year
		,ISNULL(cast(f.Class_Meeting_Number as varchar),'NA') as Class_Meeting_Number
		,RIGHT('0'+CAST(DATEPART(hour, f.Meeting_Time_Start) as varchar(2)),2) + ':' +
			   RIGHT('0'+CAST(DATEPART(minute, f.Meeting_Time_Start)as varchar(2)),2) +':'+
			   RIGHT('0'+CAST(DATEPART(SECOND, f.Meeting_Time_Start)as varchar(2)),2) as Class_Start_Time
		,RIGHT('0'+CAST(DATEPART(hour, f.Meeting_Time_End) as varchar(2)),2) + ':' +
			   RIGHT('0'+CAST(DATEPART(minute, f.Meeting_Time_End)as varchar(2)),2) +':'+
			   RIGHT('0'+CAST(DATEPART(SECOND, f.Meeting_Time_End)as varchar(2)),2) as Class_End_Time
		,cast(Duration as decimal(5,2)) as Class_Duration_In_Hours
		,b.Student_ID
		,b.Lecturer_ID
		,b.Lecturer_Name
		,Getdate() as created_on
		,Getdate()  as modified_on 
	from (
		select 
			A.*
			,a.Course_Title as Certificate_Run_Title
			,a.Qual_Type as Certificate_Qual_Type
			,Main_Qual_Type as Programme_Qual_Type
			,rs.Course_Title Programme_Run_Title
			,ROW_NUMBER()over(
					partition by a.module_code,a.class_label,a.class_nbr,a.qual_type, a.Programme,student_id  
					order by a.run_number desc) rn
		from (
				select 
					active_cet.*
					,rs.Course_Title
					,rs.Programme_Descr
					,rs.Programme as Prog_Run_Setup 
				from (
------------------------------------------------------------
					select 
						enrol.*
						,Main_Prog1
						,Student_Status
						,Specialisatn
						,CET_Run_Number
						,Admit_Term 
					from (
SELECT [Class_Label]
      ,[Student_ID]
      ,[Qual_Type]
      ,[Qual_Type_Descr]
      ,[Institution]
      ,[BOE_Term]
      ,[Class_Nbr]
      ,[Module_Component]
      ,[Main_Qual_Type]
      ,[Run_Number]
      ,[Programme]
      ,[Mod_Cohort]
      ,[Mod_School]
      ,[Acad_day]
      ,[Module_ID]
      ,[Module_Code]
      ,[Facility_ID]
      ,[Lecturer_ID]
      ,[Lecturer_Role]
      ,[Lecturer_Name]
      ,[Instructor_Assign_Seq]
      ,[Class_Capacity]
      ,[Class_Section]
      ,[Session_Code]
      ,[Course_Offer_Nbr]
      ,[Class_Start_Date]
      ,[Class_End_Date]
      ,[CREATED_ON]
      ,[MODIFIED_ON]
      ,[Main_Prog]
	  ,ROW_NUMBER() OVER (PARTITION BY [Class_Label]
									  ,[Student_ID]
									  ,[BOE_Term]
									  ,[Class_Nbr]
									  ,[Module_Component]
									  ,[Main_Qual_Type]
									  ,[Module_ID]
									  ,[Module_Code]
									  ,[Lecturer_ID]		
					ORDER BY Run_Number) smol_run_num
			FROM [RPDW_PRD].[dbo].[DW_STUDENT_ENROLMENT]
			where (Qual_Type like 'MC%' or Qual_Type like 'PDC%') and trim(Main_Qual_Type)&lt;&gt;''
						) enrol,
	(
		select 
			Student_Id
			,Admit_Term
			,Qual_type
			,Prog as Main_Prog1
			,Reqmt_Term
			,Effective_Date
			,Effective_Seq
			,Student_Status
			,Prog_Action
			,Expected_Grad_Term
			,Specialisatn
			,CET_Run_Number 
		from (
	SELECT 
		Student_Id
		,Admit_Term
		,Qual_type
		,Prog
		,Reqmt_Term
		,Effective_Date
		,Effective_Seq
		,Student_Status
		,Prog_Action
		,Expected_Grad_Term
		,Specialisatn
		,CET_Run_Number
		,ROW_NUMBER() OVER ( PARTITION BY Student_Id, Prog
					ORDER BY Effective_Date DESC, Effective_Seq DESC) rownum
	FROM DW_STUDENT_MOVEMENT
	WHERE Qual_Type not in ('DPFT','PFP','STFF')
		AND (Student_Status = 'AC' AND Prog_Action = 'MATR'
		OR (Student_Status = 'CM' AND Prog_Action = 'COMP'))
	) a where a.rownum=1
) mov
where mov.Student_Id = enrol.Student_ID
	AND mov.Qual_Type = enrol.Main_Qual_Type
	AND mov.Student_Status = 'AC'
	AND enrol.BOE_Term &gt;= mov.Admit_Term
	AND enrol.smol_run_num=1
UNION 
select 
	enrol.*
	,Main_Prog1
	,Student_Status
	,Specialisatn
	,CET_Run_Number
	,Admit_Term
from
(
SELECT [Class_Label]
      ,[Student_ID]
      ,[Qual_Type]
      ,[Qual_Type_Descr]
      ,[Institution]
      ,[BOE_Term]
      ,[Class_Nbr]
      ,[Module_Component]
      ,[Main_Qual_Type]
      ,[Run_Number]
      ,[Programme]
      ,[Mod_Cohort]
      ,[Mod_School]
      ,[Acad_day]
      ,[Module_ID]
      ,[Module_Code]
      ,[Facility_ID]
      ,[Lecturer_ID]
      ,[Lecturer_Role]
      ,[Lecturer_Name]
      ,[Instructor_Assign_Seq]
      ,[Class_Capacity]
      ,[Class_Section]
      ,[Session_Code]
      ,[Course_Offer_Nbr]
      ,[Class_Start_Date]
      ,[Class_End_Date]
      ,[CREATED_ON]
      ,[MODIFIED_ON]
      ,[Main_Prog]
	  ,ROW_NUMBER() OVER (PARTITION BY [Class_Label]
									  ,[Student_ID]
									  ,[BOE_Term]
									  ,[Class_Nbr]
									  ,[Module_Component]
									  ,[Main_Qual_Type]
									  ,[Module_ID]
									  ,[Module_Code]
									  ,[Lecturer_ID]		
					ORDER BY Run_Number) smol_run_num
			FROM [RPDW_PRD].[dbo].[DW_STUDENT_ENROLMENT]
			where (Qual_Type like 'MC%' or Qual_Type like 'PDC%') and trim(Main_Qual_Type)&lt;&gt;'') enrol,
(select Student_Id, Admit_Term, Qual_type, Prog as Main_Prog1, Reqmt_Term, Effective_Date, Effective_Seq, Student_Status, Prog_Action, Expected_Grad_Term,Specialisatn, CET_Run_Number 
from (
	SELECT Student_Id, Admit_Term, Qual_type, Prog, Reqmt_Term, Effective_Date, Effective_Seq, Student_Status, Prog_Action, Expected_Grad_Term,Specialisatn, CET_Run_Number,
	  ROW_NUMBER() OVER (
	   PARTITION BY Student_Id, Prog
   ORDER BY Effective_Date DESC, Effective_Seq DESC) rownum
  FROM DW_STUDENT_MOVEMENT
  WHERE Qual_Type not in ('DPFT','PFP','STFF')
AND (Student_Status = 'AC' AND Prog_Action = 'MATR'
OR (Student_Status = 'CM' AND Prog_Action = 'COMP'))
) a where a.rownum=1
) mov
where mov.Student_Id = enrol.Student_ID
AND mov.Qual_Type = enrol.Main_Qual_Type
AND mov.Student_Status = 'CM'
AND enrol.BOE_Term &gt;= mov.Admit_Term
AND enrol.BOE_Term &lt;= mov.Expected_Grad_Term
AND enrol.smol_run_num=1
------------------------------------------------------------
)active_cet
left join (select distinct Specialisatn, Qual_type, Programme, Programme_Descr, Student_Attribute, Acad_Term, Run_Number, Course_Title, Course_Start_Date, Course_End_Date, 
Date_Closed, Cert_Qual_Type, Cert_Programme, Cert_Programme_Descr, Cert_Specialisatn, Cert_Run_Number 
from DW_CET_RUN_SETUP) rs
 on  active_cet.programme=rs.programme and active_cet.qual_type=rs.qual_type --and active_cet.Admit_Term=rs.Acad_Term 
 and active_cet.Run_Number=rs.Run_Number

  ) A --Get_Sub_Qual_Type_Course_Title as A
  left join (
			select distinct 
				Specialisatn
				,Qual_type
				,Programme
				,Programme_Descr
				,Student_Attribute
				,Acad_Term
				,Run_Number
				,Course_Title
				,Course_Start_Date
				,Course_End_Date
				,Date_Closed
				,Cert_Qual_Type
				,Cert_Programme
				,Cert_Programme_Descr
				,Cert_Specialisatn
				,Cert_Run_Number 
			from DW_CET_RUN_SETUP) rs
on  a.Main_Prog=rs.programme and a.Main_Qual_Type=rs.qual_type --and active_cet.Admit_Term=rs.Acad_Term 
 --and a.Specialisatn=rs.Specialisatn
 and a.CET_Run_Number=rs.Run_Number
 and a.Qual_Type=rs.Cert_Qual_Type
) b

 LEFT JOIN (select  Prog_Code,Prog_Descr,School_Centre from dbo.DW_CET_PROGRAMME a1
		 where a1.Effective_Date in (select max(b1.Effective_Date) from dbo.DW_CET_PROGRAMME b1
		 where b1.Prog_Code=a1.PROG_CODE))  pt ON  b.Main_Prog=pt.Prog_Code--Get_Main_CET_Program

LEFT JOIN DW_EXT_DEPARTMENT c ON pt.School_Centre=c.Department
Left Join (select  distinct ModuleID,Module_Code,Module_Title from dbo.DW_MODULE a1
		 where a1.Effective_Date in (select max(b1.Effective_Date) from dbo.DW_MODULE b1
		 where b1.ModuleID=a1.ModuleID)) d on d.ModuleID=b.Module_ID 
LEFT JOIN DW_EXT_DEPARTMENT e ON e.Department=b.Mod_School
LEFT JOIN (
		SELECT DISTINCT  
			Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, class_Number,
			MIN(Meeting_Time_Start) AS Meeting_Time_Start, 
			MAX(Meeting_Time_End) AS Meeting_Time_End,
			SUM(CAST(DATEDIFF(minute, Meeting_Time_Start, Meeting_Time_End) AS decimal)/60.0) AS Duration
		FROM (
			SELECT Lecturer_Id, Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, Meeting_Time_Start, Meeting_Time_End,class_Number,
				ROW_NUMBER() OVER (
					   PARTITION BY Module_Id, Module_Code, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number, Meeting_Time_Start, Meeting_Time_End,class_Number
					   ORDER BY Instructor_Assign_Seq, Meeting_Time_Start desc) AS rownum
		   FROM DW_STUDENT_CLASS_SCHEDULE
		   WHERE Qual_Type not in ('DPFT','PFP','STFF')
		  -- and Class_Label='ME-6-E3209C-A' 
		  -- and Class_Meeting_Number=1 
		   and trim(Lecturer_Id)&lt;&gt;''
       --OR Qual_Type LIKE 'MC%'
       --OR Qual_Type LIKE 'PDC%'))sc
	   )sc
WHERE sc.rownum = 1
GROUP BY Lecturer_Id, Module_Id, Module_Code, Descr, Class_Label, Class_Start_Date, boe_Term, Class_Meeting_Number,class_Number)F
ON f.Class_Number=b.Class_Nbr and f.Module_Id=b.Module_ID and f.Class_Label=b.Class_Label 
and f.Class_Start_Date=b.Class_Start_Date
where rn=1)
a where Class_Meeting_Number &lt;&gt;'NA'
;


  COMMIT TRANSACTION
END TRY

BEGIN CATCH
ROLLBACK TRANSACTION

  INSERT INTO ETL_ERROR_LOG(JOB_STATUS_ID,ERROR_RECORD,created_on)
  SELECT   
         CAST(@jobstatusid as int) as JOB_STATUS_ID
        ,ERROR_MESSAGE() AS ErrorMessage
		,getdate()  as created_on
END CATCH  
GO</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{8DC88B87-7912-407B-91D8-1357BC13B61A}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="STAGE">
      <DTS:VariableValue
        DTS:DataType="8">DW</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{6589265C-65D6-4A05-95EB-B973B7807719}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="TgtTableName">
      <DTS:VariableValue
        DTS:DataType="8">DM_ACE_CET_ENROLMENT</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Create ETL Job Log"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{BE52638B-78E2-4C6F-8727-75E5396BA692}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Create ETL Job Log"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
          SQLTask:SqlStatementSource="Exec [dbo].[usp_InsertETLJobLog] ?, ?, ?, ?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::Job_name"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="1"
            SQLTask:DtsVariableName="User::STAGE"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="2"
            SQLTask:DtsVariableName="User::SourceTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="3"
            SQLTask:DtsVariableName="User::TgtTableName"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Error Log"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:Disabled="True"
      DTS:DTSID="{4CF70B25-6962-43AE-A098-8B3E015A0E96}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Error Log"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
          SQLTask:SqlStatementSource="UPDATE [dbo].[ETL_JOB_STATUS]&#xA;SET&#xA;ERROR_MSG = 'STG table is not completed',&#xA;JOB_STATUS ='Fail'&#xA;--PROCESSED_ON =getdate()&#xA;WHERE JOB_STATUS_ID=?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::JOB_STATUS_ID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="131"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\JOB_STATUS_ID"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{678876BC-5F23-41D0-BE29-465F3CA1BC85}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="JOB_STATUS_ID"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
          SQLTask:SqlStatementSource="SELECT max([JOB_STATUS_ID])&#xA;      &#xA;  FROM [dbo].[ETL_JOB_STATUS] where [SOURCE_FILENAME]=? &#xA;---and convert(varchar(8),CREATED_ON,112)=convert--(varchar(8) ,getdate(),112)"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::JOB_STATUS_ID" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::SourceTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Load Into DM"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{3CAF1A3A-4F28-4367-8640-98B6B0798E06}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Load Into DM"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4575CC56-A24D-48B8-B381-3262FCA2484A}"
          SQLTask:SqlStmtSourceType="Variable"
          SQLTask:SqlStatementSource="User::SQL_DM_Load" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Process_Date"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{72B7B301-9B67-48D7-9E9B-41FBE385200B}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Process_Date"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4575CC56-A24D-48B8-B381-3262FCA2484A}"
          SQLTask:SqlStatementSource="Select getdate()"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::Process_date" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::Process_date"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="135"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Update Job Status"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{1E53D05D-554A-4917-8C2E-B562F424633F}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Update Job Status"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
          SQLTask:SqlStatementSource="DECLARE &#xA;@jobstatusid INT &#xA;select @jobstatusid=?&#xA;IF exists(select * from dbo.ETL_ERROR_LOG where [JOB_STATUS_ID]=@jobstatusid)&#xA; BEGIN&#xA; Update [dbo].[ETL_JOB_STATUS]&#xA;SET [PROCESSED_ON] =getdate(),&#xA;[JOB_STATUS]='Fail'&#xA;where [JOB_STATUS_ID]=@jobstatusid&#xA;  END&#xA;ELSE&#xA;BEGIN&#xA;Update [dbo].[ETL_JOB_STATUS]&#xA;SET [PROCESSED_ON] =getdate(),&#xA;[JOB_STATUS]='Success'&#xA;where [JOB_STATUS_ID]=@jobstatusid&#xA;END" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::JOB_STATUS_ID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="131"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Validate job status"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:Disabled="True"
      DTS:DTSID="{30E05A74-9E98-4F46-BECE-956E4A426E4B}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Validate job status"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
          SQLTask:SqlStatementSource="select CASE WHEN JOB_STATUS='Success' then 0 ELSE 1 END AS  JOB_STATUS&#xA;&#xA;from [dbo].[ETL_JOB_STATUS]&#xA;  where STAGE='STG' and TARGET_TABLENAME='STG_OASIS_STUDENT_DEBARMT' and &#xA;  JOB_STATUS_ID in (Select max(JOB_STATUS_ID) from [dbo].[ETL_JOB_STATUS]&#xA;  where STAGE='STG' and TARGET_TABLENAME='STG_OASIS_STUDENT_DEBARMT')"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::Job_Status" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::STAGE"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="129"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 1]"
      DTS:CreationName=""
      DTS:DTSID="{68013626-84AA-479D-902B-99090F356402}"
      DTS:From="Package\Process_Date"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 1"
      DTS:To="Package\Load Into DM" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 2]"
      DTS:CreationName=""
      DTS:DTSID="{DCB19C7B-5002-4CDB-8514-58BABD788DBF}"
      DTS:From="Package\Create ETL Job Log"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 2"
      DTS:To="Package\JOB_STATUS_ID" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{C2CCA6BD-3847-44BB-94FE-FDCD650F2FBB}"
      DTS:From="Package\JOB_STATUS_ID"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\Validate job status" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 4]"
      DTS:CreationName=""
      DTS:DTSID="{0B3EEAB2-6996-41EC-8FB9-4A4FB6F010C1}"
      DTS:From="Package\Load Into DM"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 4"
      DTS:To="Package\Update Job Status" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[False]"
      DTS:CreationName=""
      DTS:DTSID="{A85C0D96-8567-4E86-A01E-ECD15AFF09ED}"
      DTS:Expression="@[User::Job_Status]==1"
      DTS:From="Package\Validate job status"
      DTS:LogicalAnd="True"
      DTS:ObjectName="False"
      DTS:To="Package\Error Log" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[True]"
      DTS:CreationName=""
      DTS:DTSID="{A0D086AB-AB1F-40FA-AC63-A7EFAB743953}"
      DTS:Expression="@[User::Job_Status]==0"
      DTS:From="Package\Validate job status"
      DTS:LogicalAnd="True"
      DTS:ObjectName="True"
      DTS:To="Package\Process_Date" />
  </DTS:PrecedenceConstraints>
  <DTS:EventHandlers>
    <DTS:EventHandler
      DTS:refId="Package.EventHandlers[OnError]"
      DTS:CreationName="OnError"
      DTS:DTSID="{5D9AE85A-BCD5-402B-BFAB-CF9B8A02292D}"
      DTS:EventID="0"
      DTS:EventName="OnError"
      DTS:LocaleID="-1">
      <DTS:Variables>
        <DTS:Variable
          DTS:CreationName=""
          DTS:Description="The propagate property of the event"
          DTS:DTSID="{43BAE831-041A-4F11-B87B-376DE5201423}"
          DTS:IncludeInDebugDump="6789"
          DTS:Namespace="System"
          DTS:ObjectName="Propagate">
          <DTS:VariableValue
            DTS:DataType="11">-1</DTS:VariableValue>
        </DTS:Variable>
      </DTS:Variables>
      <DTS:Executables>
        <DTS:Executable
          DTS:refId="Package.EventHandlers[OnError]\ETL_ERROR_LOG"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:DTSID="{B41AE45E-0B74-401D-BAC0-8C8FAF89A4D2}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="ETL_ERROR_LOG">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{65486E34-E9E5-4628-8809-E48202C2DE5D}"
              SQLTask:SqlStatementSource="[dbo].[usp_InsertETLErrorLog] ?, ?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="0"
                SQLTask:DtsVariableName="User::JOB_STATUS_ID"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="131"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="1"
                SQLTask:DtsVariableName="System::ErrorDescription"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="130"
                SQLTask:ParameterSize="-1" />
            </SQLTask:SqlTaskData>
          </DTS:ObjectData>
        </DTS:Executable>
      </DTS:Executables>
    </DTS:EventHandler>
  </DTS:EventHandlers>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="16" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="157.333333333334,42"
          Id="Package\Create ETL Job Log"
          TopLeft="17,13" />
        <NodeLayout
          Size="122.666666666667,42"
          Id="Package\Error Log"
          TopLeft="699,21" />
        <NodeLayout
          Size="142,42"
          Id="Package\JOB_STATUS_ID"
          TopLeft="230,18" />
        <NodeLayout
          Size="142.666666666667,42"
          Id="Package\Load Into DM"
          TopLeft="486,219" />
        <NodeLayout
          Size="142,42"
          Id="Package\Process_Date"
          TopLeft="487,131" />
        <NodeLayout
          Size="165.333333333334,42"
          Id="Package\Update Job Status"
          TopLeft="526,322" />
        <NodeLayout
          Size="166,42"
          Id="Package\Validate job status"
          TopLeft="446,21" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 1]"
          TopLeft="557.75,173">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,46"
              Start="0,0"
              End="0,38.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,38.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 2]"
          TopLeft="174,36.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="56,0"
              Start="0,0"
              End="48.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="48.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="372,40.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="74,0"
              Start="0,0"
              End="66.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="66.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 4]"
          TopLeft="557.5,261">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="51,61"
              Start="0,0"
              End="51,53.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,26.5" />
                  <mssgle:CubicBezierSegment
                    Point1="0,26.5"
                    Point2="0,30.5"
                    Point3="4,30.5" />
                  <mssgle:LineSegment
                    End="47,30.5" />
                  <mssgle:CubicBezierSegment
                    Point1="47,30.5"
                    Point2="51,30.5"
                    Point3="51,34.5" />
                  <mssgle:LineSegment
                    End="51,53.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[False]"
          TopLeft="612,42">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="87,0"
              Start="0,0"
              End="79.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="79.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="28.01365234375,5,23.4726953125,9.7490234375"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[True]"
          TopLeft="529,63">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="29,68"
              Start="0,0"
              End="29,60.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,30" />
                  <mssgle:CubicBezierSegment
                    Point1="0,30"
                    Point2="0,34"
                    Point3="4,34" />
                  <mssgle:LineSegment
                    End="25,34" />
                  <mssgle:CubicBezierSegment
                    Point1="25,34"
                    Point2="29,34"
                    Point3="29,38" />
                  <mssgle:LineSegment
                    End="29,60.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="3.48755859375,39,22.0248828125,9.421875"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
  <DtsEventHandler
    design-time-name="Package.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="162,42"
          Id="Package.EventHandlers[OnError]\ETL_ERROR_LOG"
          TopLeft="370,98" />
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
  <PrecedenceConstraint
    design-time-name="Package.PrecedenceConstraints[False]">
    <ShowAnnotation>ConstraintName</ShowAnnotation>
  </PrecedenceConstraint>
  <PrecedenceConstraint
    design-time-name="Package.PrecedenceConstraints[True]">
    <ShowAnnotation>ConstraintName</ShowAnnotation>
  </PrecedenceConstraint>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>