<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="1/31/2019 4:40:18 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="NCS-140119GM07"
  DTS:CreatorName="NCS\P0500450"
  DTS:DTSID="{2F7C2A2A-776B-4C9C-AB2A-683D1B17B971}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.0900.40"
  DTS:LocaleID="18441"
  DTS:ObjectName="DW_EXT_DPAEAE_JAE"
  DTS:PackageType="5"
  DTS:VersionBuild="139"
  DTS:VersionGUID="{21B5F9A9-B3C5-40D2-8E35-48EA0B5831D2}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[RPDW_DW]"
      DTS:CreationName="OLEDB"
      DTS:DelayValidation="True"
      DTS:DTSID="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
      DTS:ObjectName="RPDW_DW">
      <DTS:PropertyExpression
        DTS:Name="InitialCatalog">@[$Project::DW_Initial_Catalog]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="Password">@[$Project::Password]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="ServerName">@[$Project::ServerName]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="UserName">@[$Project::UserName]</DTS:PropertyExpression>
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=10.168.212.13;User ID=svc-dw-uat-etl;Initial Catalog=RPDW;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdGBqS7B1CkWG301g2fxV+wAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAACGdKLUcA9JSwkSMrJDWJuyAAAAAASAAACgAAAAEAAAAETiV2siOyleRqo10rrbdwcYAAAAyvmG8RmhI74LrjmkFWUBCkw+Wk2yO6RgFAAAAHAJJS5GqmwghEWWBxb/QtAPf24K</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[RPDW_STG]"
      DTS:CreationName="OLEDB"
      DTS:DelayValidation="True"
      DTS:DTSID="{879B0DE6-13AE-42EE-8332-45F291573A5E}"
      DTS:ObjectName="RPDW_STG">
      <DTS:PropertyExpression
        DTS:Name="InitialCatalog">@[$Project::Staging_Initial_Catalog]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="Password">@[$Project::Password]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="ServerName">@[$Project::ServerName]</DTS:PropertyExpression>
      <DTS:PropertyExpression
        DTS:Name="UserName">@[$Project::UserName]</DTS:PropertyExpression>
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=10.168.212.13;User ID=svc-dw-uat-etl;Initial Catalog=RPDW_STG;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdGBqS7B1CkWG301g2fxV+wAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAAB6zbUNGQ7dxiToXgn2te1FAAAAAASAAACgAAAAEAAAAKv4Fg1a0vO6EVI0yLzGolsYAAAAqPyUFPAAaBebSLbs+43NK9dBP99qhEdJFAAAADd6l187fVpfv4BOX8XV33djh13n</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{EFE1410B-2135-4E71-AF2B-247BB5A3906E}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;BEGIN TRANSACTION&#xA;BEGIN TRY&#xA;------------&#xA;DECLARE @LastDWProcessdate datetime&#xA;,@processeddatetime datetime&#xA;,@jobstatusid varchar(5)&#xA;select @jobstatusid=&quot;+ (DT_STR, 5,1252) @[User::JobStatusId] +&quot;&#xA;select @LastDWProcessdate=isnull(max(Modified_on),'1900-01-01 00:00:00.000') from [dbo].[DW_EXT_DPAEAE_JAE]&#xA;select  @processeddatetime= getdate()&#xA;&#xA;;WITH TMP_EXT_DPAEAE_JAE2&#xA;AS&#xA;(&#xA;SELECT [UIN]&#xA;      ,[STATUTORY_NM]&#xA;      ,[POSTED_COURSE_CD]&#xA;      ,[JAE_SUBJECT_CD_1]&#xA;      ,[JAE_GRADE_1]&#xA;      ,[BETTER_GRADE _1]&#xA;      ,[JAE_SUBJECT_CD_2]&#xA;      ,[JAE_GRADE_2]&#xA;      ,[BETTER_GRADE_2]&#xA;      ,[JAE_SUBJECT_CD_3]&#xA;      ,[JAE_GRADE_3]&#xA;      ,[BETTER_GRADE _3]&#xA;      ,[JAE_SUBJECT_CD_4]&#xA;      ,[JAE_GRADE_4]&#xA;      ,[BETTER_GRADE _4]&#xA;      ,[JAE_SUBJECT_CD_5]&#xA;      ,[JAE_GRADE_5]&#xA;      ,[BETTER_GRADE _5]&#xA;      ,[JAE_SUBJECT_CD_6]&#xA;      ,[JAE_GRADE_6]&#xA;      ,[BETTER_GRADE_6]&#xA;      ,[JAE_SUBJECT_CD_7]&#xA;      ,[JAE_GRADE_7]&#xA;      ,[BETTER_GRADE_7]&#xA;      ,[JAE_SUBJECT_CD_8]&#xA;      ,[JAE_GRADE_8]&#xA;      ,[BETTER_GRADE_8]&#xA;      ,[JAE_SUBJECT_CD_9]&#xA;      ,[JAE_GRADE_9]&#xA;      ,[BETTER_GRADE_9]&#xA;      ,[JAE_SUBJECT_CD_10]&#xA;      ,[JAE_GRADE_10]&#xA;      ,[BETTER_GRADE_10]&#xA;      ,[JAE_SUBJECT_CD_11]&#xA;      ,[JAE_GRADE_11]&#xA;      ,[BETTER_GRADE_11]&#xA;      ,[JAE_SUBJECT_CD_12]&#xA;      ,[JAE_GRADE_12]&#xA;      ,[BETTER_GRADE_12]&#xA;      ,[ECA_GRADE]&#xA;      ,[YR_FIRST_SITTING]&#xA;      ,[YR_SECOND_SITTING]&#xA;      ,[RAW_AGGREGATE]&#xA;      ,[NET_AGGREGATE]&#xA;      ,[DPA_IND]&#xA;      ,[COMBINED_SITTING]&#xA;      ,[CREATED_ON]&#xA;      ,[MODIFIED_ON]&#xA;      ,[AY_YEAR]&#xA;      ,[AY_SEM]&#xA;   FROM &quot;+@[$Project::Staging_Initial_Catalog]+&quot;.[dbo].[STG_EXT_DPAEAE_JAE2]&#xA;   where [Latest_Ind] ='Y' &#xA;AND [MODIFIED_ON]&gt;@LastDWProcessdate&#xA;)&#xA;&#xA;&#xA;MERGE INTO [DW_EXT_DPAEAE_JAE] AS dst&#xA;   USING TMP_EXT_DPAEAE_JAE2 AS src&#xA;  ON (&#xA;  SRC. [AY_SEM] = DST.[AY_SEM] AND   &#xA;  SRC. [AY_YEAR] = DST.[AY_YEAR] AND   &#xA;  SRC. [UIN] = DST.[UIN]&#xA;     )&#xA;&#xA;   WHEN NOT MATCHED THEN&#xA;   INSERT&#xA;&#x9;(&#xA;&#x9;   [UIN]&#xA;      ,[STATUTORY_NM]&#xA;      ,[POSTED_COURSE_CD]&#xA;      ,[JAE_SUBJECT_CD_1]&#xA;      ,[JAE_GRADE_1]&#xA;      ,[BETTER_GRADE _1]&#xA;      ,[JAE_SUBJECT_CD_2]&#xA;      ,[JAE_GRADE_2]&#xA;      ,[BETTER_GRADE_2]&#xA;      ,[JAE_SUBJECT_CD_3]&#xA;      ,[JAE_GRADE_3]&#xA;      ,[BETTER_GRADE _3]&#xA;      ,[JAE_SUBJECT_CD_4]&#xA;      ,[JAE_GRADE_4]&#xA;      ,[BETTER_GRADE _4]&#xA;      ,[JAE_SUBJECT_CD_5]&#xA;      ,[JAE_GRADE_5]&#xA;      ,[BETTER_GRADE _5]&#xA;      ,[JAE_SUBJECT_CD_6]&#xA;      ,[JAE_GRADE_6]&#xA;      ,[BETTER_GRADE_6]&#xA;      ,[JAE_SUBJECT_CD_7]&#xA;      ,[JAE_GRADE_7]&#xA;      ,[BETTER_GRADE_7]&#xA;      ,[JAE_SUBJECT_CD_8]&#xA;      ,[JAE_GRADE_8]&#xA;      ,[BETTER_GRADE_8]&#xA;      ,[JAE_SUBJECT_CD_9]&#xA;      ,[JAE_GRADE_9]&#xA;      ,[BETTER_GRADE_9]&#xA;      ,[JAE_SUBJECT_CD_10]&#xA;      ,[JAE_GRADE_10]&#xA;      ,[BETTER_GRADE_10]&#xA;      ,[JAE_SUBJECT_CD_11]&#xA;      ,[JAE_GRADE_11]&#xA;      ,[BETTER_GRADE_11]&#xA;      ,[JAE_SUBJECT_CD_12]&#xA;      ,[JAE_GRADE_12]&#xA;      ,[BETTER_GRADE_12]&#xA;      ,[ECA_GRADE]&#xA;      ,[YR_FIRST_SITTING]&#xA;      ,[YR_SECOND_SITTING]&#xA;      ,[RAW_AGGREGATE]&#xA;      ,[NET_AGGREGATE]&#xA;      ,[DPA_IND]&#xA;      ,[COMBINED_SITTING]&#xA;      ,[CREATED_ON]&#xA;      ,[MODIFIED_ON]&#xA;      ,[AY_YEAR]&#xA;      ,[AY_SEM]&#xA;&#x9;  )&#xA;VALUES&#xA;&#x9;(  &#xA;       SRC.[UIN]&#xA;      ,SRC.[STATUTORY_NM]&#xA;      ,SRC.[POSTED_COURSE_CD]&#xA;      ,SRC.[JAE_SUBJECT_CD_1]&#xA;      ,SRC.[JAE_GRADE_1]&#xA;      ,SRC.[BETTER_GRADE _1]&#xA;      ,SRC.[JAE_SUBJECT_CD_2]&#xA;      ,SRC.[JAE_GRADE_2]&#xA;      ,SRC.[BETTER_GRADE_2]&#xA;      ,SRC.[JAE_SUBJECT_CD_3]&#xA;      ,SRC.[JAE_GRADE_3]&#xA;      ,SRC.[BETTER_GRADE _3]&#xA;      ,SRC.[JAE_SUBJECT_CD_4]&#xA;      ,SRC.[JAE_GRADE_4]&#xA;      ,SRC.[BETTER_GRADE _4]&#xA;      ,SRC.[JAE_SUBJECT_CD_5]&#xA;      ,SRC.[JAE_GRADE_5]&#xA;      ,SRC.[BETTER_GRADE _5]&#xA;      ,SRC.[JAE_SUBJECT_CD_6]&#xA;      ,SRC.[JAE_GRADE_6]&#xA;      ,SRC.[BETTER_GRADE_6]&#xA;      ,SRC.[JAE_SUBJECT_CD_7]&#xA;      ,SRC.[JAE_GRADE_7]&#xA;      ,SRC.[BETTER_GRADE_7]&#xA;      ,SRC.[JAE_SUBJECT_CD_8]&#xA;      ,SRC.[JAE_GRADE_8]&#xA;      ,SRC.[BETTER_GRADE_8]&#xA;      ,SRC.[JAE_SUBJECT_CD_9]&#xA;      ,SRC.[JAE_GRADE_9]&#xA;      ,SRC.[BETTER_GRADE_9]&#xA;      ,SRC.[JAE_SUBJECT_CD_10]&#xA;      ,SRC.[JAE_GRADE_10]&#xA;      ,SRC.[BETTER_GRADE_10]&#xA;      ,SRC.[JAE_SUBJECT_CD_11]&#xA;      ,SRC.[JAE_GRADE_11]&#xA;      ,SRC.[BETTER_GRADE_11]&#xA;      ,SRC.[JAE_SUBJECT_CD_12]&#xA;      ,SRC.[JAE_GRADE_12]&#xA;      ,SRC.[BETTER_GRADE_12]&#xA;      ,SRC.[ECA_GRADE]&#xA;      ,SRC.[YR_FIRST_SITTING]&#xA;      ,SRC.[YR_SECOND_SITTING]&#xA;      ,SRC.[RAW_AGGREGATE]&#xA;      ,SRC.[NET_AGGREGATE]&#xA;      ,SRC.[DPA_IND]&#xA;      ,SRC.[COMBINED_SITTING]&#xA;      ,SRC.[CREATED_ON]&#xA;      ,SRC.[MODIFIED_ON]&#xA;      ,SRC.[AY_YEAR]&#xA;      ,SRC.[AY_SEM]&#xA;&#x9;)&#xA;   WHEN MATCHED&#xA;   &#xA;   THEN UPDATE&#xA;   SET &#x9; &#xA;   DST.[AY_SEM] =  ISNULL(SRC.[AY_SEM],'')  ,  &#xA;   DST.[AY_YEAR] =  ISNULL(SRC.[AY_YEAR],'')  ,  &#xA;   DST.[BETTER_GRADE _1] =  ISNULL(SRC.[BETTER_GRADE _1],'')  ,  &#xA;   DST.[BETTER_GRADE _3] =  ISNULL(SRC.[BETTER_GRADE _3],'')  ,  &#xA;   DST.[BETTER_GRADE _4] =  ISNULL(SRC.[BETTER_GRADE _4],'')  ,  &#xA;   DST.[BETTER_GRADE _5] =  ISNULL(SRC.[BETTER_GRADE _5],'')  ,  &#xA;   DST.[BETTER_GRADE_10] =  ISNULL(SRC.[BETTER_GRADE_10],'')  ,  &#xA;   DST.[BETTER_GRADE_11] =  ISNULL(SRC.[BETTER_GRADE_11],'')  ,  &#xA;   DST.[BETTER_GRADE_12] =  ISNULL(SRC.[BETTER_GRADE_12],'')  ,  &#xA;   DST.[BETTER_GRADE_2] =  ISNULL(SRC.[BETTER_GRADE_2],'')  ,  &#xA;   DST.[BETTER_GRADE_6] =  ISNULL(SRC.[BETTER_GRADE_6],'')  ,  &#xA;   DST.[BETTER_GRADE_7] =  ISNULL(SRC.[BETTER_GRADE_7],'')  ,  &#xA;   DST.[BETTER_GRADE_8] =  ISNULL(SRC.[BETTER_GRADE_8],'')  ,  &#xA;   DST.[BETTER_GRADE_9] =  ISNULL(SRC.[BETTER_GRADE_9],'')  ,  &#xA;   DST.[COMBINED_SITTING] =  ISNULL(SRC.[COMBINED_SITTING],'')  ,  &#xA;   DST.[CREATED_ON] =  ISNULL(SRC.[CREATED_ON],'')  ,  &#xA;   DST.[DPA_IND] =  ISNULL(SRC.[DPA_IND],'')  ,  &#xA;   DST.[ECA_GRADE] =  ISNULL(SRC.[ECA_GRADE],'')  ,  &#xA;   DST.[JAE_GRADE_1] =  ISNULL(SRC.[JAE_GRADE_1],'')  ,  &#xA;   DST.[JAE_GRADE_10] =  ISNULL(SRC.[JAE_GRADE_10],'')  ,  &#xA;   DST.[JAE_GRADE_11] =  ISNULL(SRC.[JAE_GRADE_11],'')  ,  &#xA;   DST.[JAE_GRADE_12] =  ISNULL(SRC.[JAE_GRADE_12],'')  ,  &#xA;   DST.[JAE_GRADE_2] =  ISNULL(SRC.[JAE_GRADE_2],'')  ,  &#xA;   DST.[JAE_GRADE_3] =  ISNULL(SRC.[JAE_GRADE_3],'')  ,  &#xA;   DST.[JAE_GRADE_4] =  ISNULL(SRC.[JAE_GRADE_4],'')  ,  &#xA;   DST.[JAE_GRADE_5] =  ISNULL(SRC.[JAE_GRADE_5],'')  ,  &#xA;   DST.[JAE_GRADE_6] =  ISNULL(SRC.[JAE_GRADE_6],'')  ,  &#xA;   DST.[JAE_GRADE_7] =  ISNULL(SRC.[JAE_GRADE_7],'')  ,  &#xA;   DST.[JAE_GRADE_8] =  ISNULL(SRC.[JAE_GRADE_8],'')  ,  &#xA;   DST.[JAE_GRADE_9] =  ISNULL(SRC.[JAE_GRADE_9],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_1] =  ISNULL(SRC.[JAE_SUBJECT_CD_1],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_10] =  ISNULL(SRC.[JAE_SUBJECT_CD_10],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_11] =  ISNULL(SRC.[JAE_SUBJECT_CD_11],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_12] =  ISNULL(SRC.[JAE_SUBJECT_CD_12],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_2] =  ISNULL(SRC.[JAE_SUBJECT_CD_2],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_3] =  ISNULL(SRC.[JAE_SUBJECT_CD_3],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_4] =  ISNULL(SRC.[JAE_SUBJECT_CD_4],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_5] =  ISNULL(SRC.[JAE_SUBJECT_CD_5],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_6] =  ISNULL(SRC.[JAE_SUBJECT_CD_6],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_7] =  ISNULL(SRC.[JAE_SUBJECT_CD_7],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_8] =  ISNULL(SRC.[JAE_SUBJECT_CD_8],'')  ,  &#xA;   DST.[JAE_SUBJECT_CD_9] =  ISNULL(SRC.[JAE_SUBJECT_CD_9],'')  ,  &#xA;   DST.[MODIFIED_ON] =  ISNULL(SRC.[MODIFIED_ON],'')  ,  &#xA;   DST.[NET_AGGREGATE] =  ISNULL(SRC.[NET_AGGREGATE],'')  ,  &#xA;   DST.[POSTED_COURSE_CD] =  ISNULL(SRC.[POSTED_COURSE_CD],'')  , &#xA;   DST.[RAW_AGGREGATE] =  ISNULL(SRC.[RAW_AGGREGATE],'')  ,  &#xA;   DST.[STATUTORY_NM] =  ISNULL(SRC.[STATUTORY_NM],'')  ,  &#xA;   DST.[UIN] =  ISNULL(SRC.[UIN],'')  , &#xA;   DST.[YR_FIRST_SITTING] =  ISNULL(SRC.[YR_FIRST_SITTING],'')  ,  &#xA;   DST.[YR_SECOND_SITTING] =  ISNULL(SRC.[YR_SECOND_SITTING],'') ; &#xA;&#x9;&#xA;&#xA;--------------------------------------&#xA;COMMIT TRANSACTION&#xA;END TRY&#xA;&#xA;BEGIN CATCH&#xA;  ROLLBACK TRANSACTION&#xA;INSERT INTO ETL_ERROR_LOG(JOB_STATUS_ID,ERROR_RECORD,created_on)&#xA;  SELECT   &#xA;         CAST(@jobstatusid as int) as JOB_STATUS_ID&#xA;        ,ERROR_MESSAGE() AS ErrorMessage&#xA;&#x9;&#x9;,@processeddatetime  as created_on&#xA;  &#xA;  &#xA;END CATCH  &#xA;GO&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="InsertQuery">
      <DTS:VariableValue
        DTS:DataType="8">BEGIN TRANSACTION
BEGIN TRY
------------
DECLARE @LastDWProcessdate datetime
,@processeddatetime datetime
,@jobstatusid varchar(5)
select @jobstatusid=0
select @LastDWProcessdate=isnull(max(Modified_on),'1900-01-01 00:00:00.000') from [dbo].[DW_EXT_DPAEAE_JAE]
select  @processeddatetime= getdate()

;WITH TMP_EXT_DPAEAE_JAE2
AS
(
SELECT [UIN]
      ,[STATUTORY_NM]
      ,[POSTED_COURSE_CD]
      ,[JAE_SUBJECT_CD_1]
      ,[JAE_GRADE_1]
      ,[BETTER_GRADE _1]
      ,[JAE_SUBJECT_CD_2]
      ,[JAE_GRADE_2]
      ,[BETTER_GRADE_2]
      ,[JAE_SUBJECT_CD_3]
      ,[JAE_GRADE_3]
      ,[BETTER_GRADE _3]
      ,[JAE_SUBJECT_CD_4]
      ,[JAE_GRADE_4]
      ,[BETTER_GRADE _4]
      ,[JAE_SUBJECT_CD_5]
      ,[JAE_GRADE_5]
      ,[BETTER_GRADE _5]
      ,[JAE_SUBJECT_CD_6]
      ,[JAE_GRADE_6]
      ,[BETTER_GRADE_6]
      ,[JAE_SUBJECT_CD_7]
      ,[JAE_GRADE_7]
      ,[BETTER_GRADE_7]
      ,[JAE_SUBJECT_CD_8]
      ,[JAE_GRADE_8]
      ,[BETTER_GRADE_8]
      ,[JAE_SUBJECT_CD_9]
      ,[JAE_GRADE_9]
      ,[BETTER_GRADE_9]
      ,[JAE_SUBJECT_CD_10]
      ,[JAE_GRADE_10]
      ,[BETTER_GRADE_10]
      ,[JAE_SUBJECT_CD_11]
      ,[JAE_GRADE_11]
      ,[BETTER_GRADE_11]
      ,[JAE_SUBJECT_CD_12]
      ,[JAE_GRADE_12]
      ,[BETTER_GRADE_12]
      ,[ECA_GRADE]
      ,[YR_FIRST_SITTING]
      ,[YR_SECOND_SITTING]
      ,[RAW_AGGREGATE]
      ,[NET_AGGREGATE]
      ,[DPA_IND]
      ,[COMBINED_SITTING]
      ,[CREATED_ON]
      ,[MODIFIED_ON]
      ,[AY_YEAR]
      ,[AY_SEM]
   FROM RPDW_STG.[dbo].[STG_EXT_DPAEAE_JAE2]
   where [Latest_Ind] ='Y' 
AND [MODIFIED_ON]&gt;@LastDWProcessdate
)


MERGE INTO [DW_EXT_DPAEAE_JAE] AS dst
   USING TMP_EXT_DPAEAE_JAE2 AS src
  ON (
  SRC. [AY_SEM] = DST.[AY_SEM] AND   
  SRC. [AY_YEAR] = DST.[AY_YEAR] AND   
  SRC. [UIN] = DST.[UIN]
     )

   WHEN NOT MATCHED THEN
   INSERT
	(
	   [UIN]
      ,[STATUTORY_NM]
      ,[POSTED_COURSE_CD]
      ,[JAE_SUBJECT_CD_1]
      ,[JAE_GRADE_1]
      ,[BETTER_GRADE _1]
      ,[JAE_SUBJECT_CD_2]
      ,[JAE_GRADE_2]
      ,[BETTER_GRADE_2]
      ,[JAE_SUBJECT_CD_3]
      ,[JAE_GRADE_3]
      ,[BETTER_GRADE _3]
      ,[JAE_SUBJECT_CD_4]
      ,[JAE_GRADE_4]
      ,[BETTER_GRADE _4]
      ,[JAE_SUBJECT_CD_5]
      ,[JAE_GRADE_5]
      ,[BETTER_GRADE _5]
      ,[JAE_SUBJECT_CD_6]
      ,[JAE_GRADE_6]
      ,[BETTER_GRADE_6]
      ,[JAE_SUBJECT_CD_7]
      ,[JAE_GRADE_7]
      ,[BETTER_GRADE_7]
      ,[JAE_SUBJECT_CD_8]
      ,[JAE_GRADE_8]
      ,[BETTER_GRADE_8]
      ,[JAE_SUBJECT_CD_9]
      ,[JAE_GRADE_9]
      ,[BETTER_GRADE_9]
      ,[JAE_SUBJECT_CD_10]
      ,[JAE_GRADE_10]
      ,[BETTER_GRADE_10]
      ,[JAE_SUBJECT_CD_11]
      ,[JAE_GRADE_11]
      ,[BETTER_GRADE_11]
      ,[JAE_SUBJECT_CD_12]
      ,[JAE_GRADE_12]
      ,[BETTER_GRADE_12]
      ,[ECA_GRADE]
      ,[YR_FIRST_SITTING]
      ,[YR_SECOND_SITTING]
      ,[RAW_AGGREGATE]
      ,[NET_AGGREGATE]
      ,[DPA_IND]
      ,[COMBINED_SITTING]
      ,[CREATED_ON]
      ,[MODIFIED_ON]
      ,[AY_YEAR]
      ,[AY_SEM]
	  )
VALUES
	(  
       SRC.[UIN]
      ,SRC.[STATUTORY_NM]
      ,SRC.[POSTED_COURSE_CD]
      ,SRC.[JAE_SUBJECT_CD_1]
      ,SRC.[JAE_GRADE_1]
      ,SRC.[BETTER_GRADE _1]
      ,SRC.[JAE_SUBJECT_CD_2]
      ,SRC.[JAE_GRADE_2]
      ,SRC.[BETTER_GRADE_2]
      ,SRC.[JAE_SUBJECT_CD_3]
      ,SRC.[JAE_GRADE_3]
      ,SRC.[BETTER_GRADE _3]
      ,SRC.[JAE_SUBJECT_CD_4]
      ,SRC.[JAE_GRADE_4]
      ,SRC.[BETTER_GRADE _4]
      ,SRC.[JAE_SUBJECT_CD_5]
      ,SRC.[JAE_GRADE_5]
      ,SRC.[BETTER_GRADE _5]
      ,SRC.[JAE_SUBJECT_CD_6]
      ,SRC.[JAE_GRADE_6]
      ,SRC.[BETTER_GRADE_6]
      ,SRC.[JAE_SUBJECT_CD_7]
      ,SRC.[JAE_GRADE_7]
      ,SRC.[BETTER_GRADE_7]
      ,SRC.[JAE_SUBJECT_CD_8]
      ,SRC.[JAE_GRADE_8]
      ,SRC.[BETTER_GRADE_8]
      ,SRC.[JAE_SUBJECT_CD_9]
      ,SRC.[JAE_GRADE_9]
      ,SRC.[BETTER_GRADE_9]
      ,SRC.[JAE_SUBJECT_CD_10]
      ,SRC.[JAE_GRADE_10]
      ,SRC.[BETTER_GRADE_10]
      ,SRC.[JAE_SUBJECT_CD_11]
      ,SRC.[JAE_GRADE_11]
      ,SRC.[BETTER_GRADE_11]
      ,SRC.[JAE_SUBJECT_CD_12]
      ,SRC.[JAE_GRADE_12]
      ,SRC.[BETTER_GRADE_12]
      ,SRC.[ECA_GRADE]
      ,SRC.[YR_FIRST_SITTING]
      ,SRC.[YR_SECOND_SITTING]
      ,SRC.[RAW_AGGREGATE]
      ,SRC.[NET_AGGREGATE]
      ,SRC.[DPA_IND]
      ,SRC.[COMBINED_SITTING]
      ,SRC.[CREATED_ON]
      ,SRC.[MODIFIED_ON]
      ,SRC.[AY_YEAR]
      ,SRC.[AY_SEM]
	)
   WHEN MATCHED
   
   THEN UPDATE
   SET 	 
   DST.[AY_SEM] =  ISNULL(SRC.[AY_SEM],'')  ,  
   DST.[AY_YEAR] =  ISNULL(SRC.[AY_YEAR],'')  ,  
   DST.[BETTER_GRADE _1] =  ISNULL(SRC.[BETTER_GRADE _1],'')  ,  
   DST.[BETTER_GRADE _3] =  ISNULL(SRC.[BETTER_GRADE _3],'')  ,  
   DST.[BETTER_GRADE _4] =  ISNULL(SRC.[BETTER_GRADE _4],'')  ,  
   DST.[BETTER_GRADE _5] =  ISNULL(SRC.[BETTER_GRADE _5],'')  ,  
   DST.[BETTER_GRADE_10] =  ISNULL(SRC.[BETTER_GRADE_10],'')  ,  
   DST.[BETTER_GRADE_11] =  ISNULL(SRC.[BETTER_GRADE_11],'')  ,  
   DST.[BETTER_GRADE_12] =  ISNULL(SRC.[BETTER_GRADE_12],'')  ,  
   DST.[BETTER_GRADE_2] =  ISNULL(SRC.[BETTER_GRADE_2],'')  ,  
   DST.[BETTER_GRADE_6] =  ISNULL(SRC.[BETTER_GRADE_6],'')  ,  
   DST.[BETTER_GRADE_7] =  ISNULL(SRC.[BETTER_GRADE_7],'')  ,  
   DST.[BETTER_GRADE_8] =  ISNULL(SRC.[BETTER_GRADE_8],'')  ,  
   DST.[BETTER_GRADE_9] =  ISNULL(SRC.[BETTER_GRADE_9],'')  ,  
   DST.[COMBINED_SITTING] =  ISNULL(SRC.[COMBINED_SITTING],'')  ,  
   DST.[CREATED_ON] =  ISNULL(SRC.[CREATED_ON],'')  ,  
   DST.[DPA_IND] =  ISNULL(SRC.[DPA_IND],'')  ,  
   DST.[ECA_GRADE] =  ISNULL(SRC.[ECA_GRADE],'')  ,  
   DST.[JAE_GRADE_1] =  ISNULL(SRC.[JAE_GRADE_1],'')  ,  
   DST.[JAE_GRADE_10] =  ISNULL(SRC.[JAE_GRADE_10],'')  ,  
   DST.[JAE_GRADE_11] =  ISNULL(SRC.[JAE_GRADE_11],'')  ,  
   DST.[JAE_GRADE_12] =  ISNULL(SRC.[JAE_GRADE_12],'')  ,  
   DST.[JAE_GRADE_2] =  ISNULL(SRC.[JAE_GRADE_2],'')  ,  
   DST.[JAE_GRADE_3] =  ISNULL(SRC.[JAE_GRADE_3],'')  ,  
   DST.[JAE_GRADE_4] =  ISNULL(SRC.[JAE_GRADE_4],'')  ,  
   DST.[JAE_GRADE_5] =  ISNULL(SRC.[JAE_GRADE_5],'')  ,  
   DST.[JAE_GRADE_6] =  ISNULL(SRC.[JAE_GRADE_6],'')  ,  
   DST.[JAE_GRADE_7] =  ISNULL(SRC.[JAE_GRADE_7],'')  ,  
   DST.[JAE_GRADE_8] =  ISNULL(SRC.[JAE_GRADE_8],'')  ,  
   DST.[JAE_GRADE_9] =  ISNULL(SRC.[JAE_GRADE_9],'')  ,  
   DST.[JAE_SUBJECT_CD_1] =  ISNULL(SRC.[JAE_SUBJECT_CD_1],'')  ,  
   DST.[JAE_SUBJECT_CD_10] =  ISNULL(SRC.[JAE_SUBJECT_CD_10],'')  ,  
   DST.[JAE_SUBJECT_CD_11] =  ISNULL(SRC.[JAE_SUBJECT_CD_11],'')  ,  
   DST.[JAE_SUBJECT_CD_12] =  ISNULL(SRC.[JAE_SUBJECT_CD_12],'')  ,  
   DST.[JAE_SUBJECT_CD_2] =  ISNULL(SRC.[JAE_SUBJECT_CD_2],'')  ,  
   DST.[JAE_SUBJECT_CD_3] =  ISNULL(SRC.[JAE_SUBJECT_CD_3],'')  ,  
   DST.[JAE_SUBJECT_CD_4] =  ISNULL(SRC.[JAE_SUBJECT_CD_4],'')  ,  
   DST.[JAE_SUBJECT_CD_5] =  ISNULL(SRC.[JAE_SUBJECT_CD_5],'')  ,  
   DST.[JAE_SUBJECT_CD_6] =  ISNULL(SRC.[JAE_SUBJECT_CD_6],'')  ,  
   DST.[JAE_SUBJECT_CD_7] =  ISNULL(SRC.[JAE_SUBJECT_CD_7],'')  ,  
   DST.[JAE_SUBJECT_CD_8] =  ISNULL(SRC.[JAE_SUBJECT_CD_8],'')  ,  
   DST.[JAE_SUBJECT_CD_9] =  ISNULL(SRC.[JAE_SUBJECT_CD_9],'')  ,  
   DST.[MODIFIED_ON] =  ISNULL(SRC.[MODIFIED_ON],'')  ,  
   DST.[NET_AGGREGATE] =  ISNULL(SRC.[NET_AGGREGATE],'')  ,  
   DST.[POSTED_COURSE_CD] =  ISNULL(SRC.[POSTED_COURSE_CD],'')  , 
   DST.[RAW_AGGREGATE] =  ISNULL(SRC.[RAW_AGGREGATE],'')  ,  
   DST.[STATUTORY_NM] =  ISNULL(SRC.[STATUTORY_NM],'')  ,  
   DST.[UIN] =  ISNULL(SRC.[UIN],'')  , 
   DST.[YR_FIRST_SITTING] =  ISNULL(SRC.[YR_FIRST_SITTING],'')  ,  
   DST.[YR_SECOND_SITTING] =  ISNULL(SRC.[YR_SECOND_SITTING],'') ; 
	

--------------------------------------
COMMIT TRANSACTION
END TRY

BEGIN CATCH
  ROLLBACK TRANSACTION
INSERT INTO ETL_ERROR_LOG(JOB_STATUS_ID,ERROR_RECORD,created_on)
  SELECT   
         CAST(@jobstatusid as int) as JOB_STATUS_ID
        ,ERROR_MESSAGE() AS ErrorMessage
		,@processeddatetime  as created_on
  
  
END CATCH  
GO</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{A3C155FB-9692-4D1B-823D-202625BBFFA5}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="JobStatusId">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{C3EB2DA1-AA4A-4EC3-9509-D0B8643621F7}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="Job_Name">
      <DTS:VariableValue
        DTS:DataType="8">DW_EXT_DPAEAE_JAE</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{5912677E-EEDC-4AC2-A991-11BCF922749C}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="MndColumncheck">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{956DCC01-A5CE-4A34-BFED-C1C6B23B5157}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="PrevJobStatus">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B9E1337F-CE6F-4CE1-B46D-8BC06CA87227}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="sqlprimarykeycheck">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B3E33603-C640-4109-8C82-C0656C73F35F}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="sqlprocesseddate">
      <DTS:VariableValue
        DTS:DataType="7">2/27/2019 11:28:00 AM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{0A0CD05F-1A97-4598-8B27-B6096DA489A7}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="SrcTable">
      <DTS:VariableValue
        DTS:DataType="8">STG_EXT_DPAEAE_JAE2</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{3715F669-BE35-4CFF-9A54-7931B08585D2}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="Stage">
      <DTS:VariableValue
        DTS:DataType="8">DW</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{84AF1BFD-6E2F-471F-AC44-C05BEE46E76E}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="TgtTable">
      <DTS:VariableValue
        DTS:DataType="8">DW_EXT_DPAEAE_JAE</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\check previous job status"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{9446551D-522C-4BA9-A9E6-E08F9306CB4E}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="check previous job status"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="&#xA;SELECT CASE WHEN [JOB_STATUS] ='SUCCESS' THEN 1 ELSE 0 END AS PrevJobStatus&#xA;FROM [DBO].[ETL_JOB_STATUS] WHERE [JOB_STATUS_ID]=&#xA;(SELECT MAX([JOB_STATUS_ID]) FROM [DBO].[ETL_JOB_STATUS]&#xA;WHERE [TARGET_TABLENAME]=?&#xA;AND [STAGE]='STG')&#xA;&#xA;"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="PrevJobStatus"
            SQLTask:DtsVariableName="User::PrevJobStatus" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::SrcTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Create ETL Job Log"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{55EB1E50-BEE6-4438-9A0F-E174DBC5577A}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Create ETL Job Log"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="&#xA;EXEC dbo.[usp_InsertETLJobLog]  ?,?,?,?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::Job_Name"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="1"
            SQLTask:DtsVariableName="User::Stage"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="2"
            SQLTask:DtsVariableName="User::SrcTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="3"
            SQLTask:DtsVariableName="User::TgtTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\get Job Status Id"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{7212DDF9-03D0-47E4-8559-90CFD4A29022}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="get Job Status Id"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="declare  @JobstatusID int&#xA;&#xA;select @JobstatusID=max(job_status_id) from [ETL_JOB_STATUS]&#xA;where [TARGET_TABLENAME]=?&#xA;&#xA;&#xA;Select @JobstatusID "
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::JobStatusId" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::TgtTable"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="130"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\getprocesseddate"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{96521BA2-C5C9-4DD4-B3FA-2CD1D7A28BCC}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="getprocesseddate"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="SELECT GETDATE()"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::sqlprocesseddate" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\insert into main table"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{2349EC0D-0A42-4450-AA6F-4310835DDF94}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="insert into main table"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStmtSourceType="Variable"
          SQLTask:SqlStatementSource="User::InsertQuery" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Masking"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{ED841F25-08F7-4567-8E83-93D9CFA71C56}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Masking"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="UPDATE A SET  A.MASKED_NATIONAL_ID=U.MASKED_NATIONAL_ID FROM DW_NATIONAL_ID_MASKING U JOIN   DW_EXT_DPAEAE_JAE  A ON A.UIN=U.NATIONAL_ID" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\update on failure"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{FB2000F7-D0EC-405C-AFD3-8E9A1D262303}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="update on failure"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="   UPDATE [DBO].[ETL_JOB_STATUS]&#xA;  SET [JOB_STATUS]='Fail',&#xA;[ERROR_MSG]='Last Job not completed sucessfully'&#xA;  where [JOB_STATUS_ID]=?&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::JobStatusId"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\UpdateJobStatus"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{2FB29B81-7365-424F-8A9B-C403D1C03697}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="UpdateJobStatus"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
          SQLTask:SqlStatementSource="&#xA; &#xA;&#xA;DECLARE &#xA;@jobstatusid INT&#xA;select @jobstatusid=?&#xA;IF EXISTS(SELECT * FROM dbo.ETL_ERROR_LOG WHERE [JOB_STATUS_ID]=@jobstatusid)&#xA;&#xA; BEGIN&#xA;&#xA;&#xA;&#xA; UPDATE [dbo].[ETL_JOB_STATUS]&#xA;&#xA;SET [PROCESSED_ON] =GETDATE(),&#xA;&#xA;[JOB_STATUS]='FAIL'&#xA;&#xA;WHERE [JOB_STATUS_ID]=@jobstatusid&#xA;&#xA;  END&#xA;&#xA;ELSE&#xA;&#xA;BEGIN&#xA;&#xA;UPDATE [DBO].[ETL_JOB_STATUS]&#xA;&#xA;SET [PROCESSED_ON] =GETDATE(),&#xA;&#xA;[JOB_STATUS]='Success'&#xA;&#xA;WHERE [JOB_STATUS_ID]=@jobstatusid&#xA;&#xA;END&#xA;&#xA; " xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::JobStatusId"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{43C2E29C-06B4-4DDF-BA97-CC67BE5264B1}"
      DTS:EvalOp="1"
      DTS:Expression="@[User::PrevJobStatus]==0"
      DTS:From="Package\check previous job status"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\update on failure" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 1]"
      DTS:CreationName=""
      DTS:DTSID="{C84009BF-5DCA-406A-8D71-9A6A8CFD0A1F}"
      DTS:From="Package\Create ETL Job Log"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 1"
      DTS:To="Package\get Job Status Id" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 2]"
      DTS:CreationName=""
      DTS:DTSID="{06BF2DCC-88CB-4F7C-8D4E-3EC742C6781C}"
      DTS:From="Package\getprocesseddate"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 2"
      DTS:To="Package\insert into main table" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{8644BEE3-517A-4A23-B9E4-0E6D6E5BD5F1}"
      DTS:EvalOp="1"
      DTS:Expression="@[User::PrevJobStatus]==1"
      DTS:From="Package\check previous job status"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\getprocesseddate" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 4]"
      DTS:CreationName=""
      DTS:DTSID="{BB4D60E4-A4B9-462C-85CD-F406D11A65C9}"
      DTS:From="Package\get Job Status Id"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 4"
      DTS:To="Package\check previous job status" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 5]"
      DTS:CreationName=""
      DTS:DTSID="{9A58FF59-97CB-4F1F-9536-D51612D1483F}"
      DTS:From="Package\insert into main table"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 5"
      DTS:To="Package\Masking" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 6]"
      DTS:CreationName=""
      DTS:DTSID="{1F62848C-3A6D-4705-AA50-0D2B90E41F56}"
      DTS:From="Package\Masking"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 6"
      DTS:To="Package\UpdateJobStatus" />
  </DTS:PrecedenceConstraints>
  <DTS:EventHandlers>
    <DTS:EventHandler
      DTS:refId="Package.EventHandlers[OnError]"
      DTS:CreationName="OnError"
      DTS:DTSID="{00B292C6-A5B2-481C-9048-166842AB5362}"
      DTS:EventID="0"
      DTS:EventName="OnError"
      DTS:LocaleID="-1">
      <DTS:Variables>
        <DTS:Variable
          DTS:CreationName=""
          DTS:Description="The propagate property of the event"
          DTS:DTSID="{A326E6E8-CF6C-4018-BE1E-EE969F71D1B5}"
          DTS:IncludeInDebugDump="6789"
          DTS:Namespace="System"
          DTS:ObjectName="Propagate">
          <DTS:VariableValue
            DTS:DataType="11">-1</DTS:VariableValue>
        </DTS:Variable>
      </DTS:Variables>
      <DTS:Executables>
        <DTS:Executable
          DTS:refId="Package.EventHandlers[OnError]\Error Log"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:DTSID="{9EDB1C10-6797-44AE-A685-B3A8637D3F6C}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="Error Log">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
              SQLTask:SqlStatementSource="  insert into [dbo].[ETL_ERROR_LOG]([JOB_STATUS_ID],[ERROR_RECORD])&#xA;  select ?,?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="1"
                SQLTask:DtsVariableName="System::ErrorDescription"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="130"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="0"
                SQLTask:DtsVariableName="User::JobStatusId"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="3"
                SQLTask:ParameterSize="-1" />
            </SQLTask:SqlTaskData>
          </DTS:ObjectData>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package.EventHandlers[OnError]\ETL Job Status Log"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:DTSID="{3FF9984B-B659-4980-A5D9-B6CBCDFCF85B}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="ETL Job Status Log">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{5A9C3D51-01BC-46AD-A532-7013029B26C3}"
              SQLTask:SqlStatementSource="update [ETL_JOB_STATUS]&#xA;set Job_Status='Fail'&#xA;,Error_Msg=?&#xA;where job_status_id=?" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="0"
                SQLTask:DtsVariableName="System::ErrorDescription"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="130"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="1"
                SQLTask:DtsVariableName="User::JobStatusId"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="3"
                SQLTask:ParameterSize="-1" />
            </SQLTask:SqlTaskData>
          </DTS:ObjectData>
        </DTS:Executable>
      </DTS:Executables>
      <DTS:PrecedenceConstraints>
        <DTS:PrecedenceConstraint
          DTS:refId="Package.EventHandlers[OnError].PrecedenceConstraints[Constraint]"
          DTS:CreationName=""
          DTS:DTSID="{073316B5-1E75-4CEC-A46D-DFEBCA5B7B76}"
          DTS:From="Package.EventHandlers[OnError]\Error Log"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint"
          DTS:To="Package.EventHandlers[OnError]\ETL Job Status Log" />
      </DTS:PrecedenceConstraints>
    </DTS:EventHandler>
  </DTS:EventHandlers>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="16" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="198,42"
          Id="Package\check previous job status"
          TopLeft="415,32" />
        <NodeLayout
          Size="170,42"
          Id="Package\Create ETL Job Log"
          TopLeft="9,30" />
        <NodeLayout
          Size="159,42"
          Id="Package\get Job Status Id"
          TopLeft="225,31" />
        <NodeLayout
          Size="162,42"
          Id="Package\getprocesseddate"
          TopLeft="660,29" />
        <NodeLayout
          Size="179,42"
          Id="Package\insert into main table"
          TopLeft="648,128" />
        <NodeLayout
          Size="117,42"
          Id="Package\Masking"
          TopLeft="887,132" />
        <NodeLayout
          Size="159,42"
          Id="Package\update on failure"
          TopLeft="418,164" />
        <NodeLayout
          Size="158,42"
          Id="Package\UpdateJobStatus"
          TopLeft="661,214" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="514,74">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-16.5,90"
              Start="0,0"
              End="-16.5,82.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,41" />
                  <mssgle:CubicBezierSegment
                    Point1="0,41"
                    Point2="0,45"
                    Point3="-4,45" />
                  <mssgle:LineSegment
                    End="-12.5,45" />
                  <mssgle:CubicBezierSegment
                    Point1="-12.5,45"
                    Point2="-16.5,45"
                    Point3="-16.5,49" />
                  <mssgle:LineSegment
                    End="-16.5,82.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="-16.25,50,16,16"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 1]"
          TopLeft="179,51.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="46,0"
              Start="0,0"
              End="38.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="38.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 2]"
          TopLeft="739.25,71">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,57"
              Start="0,0"
              End="0,49.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,49.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="613,51.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="47,0"
              Start="0,0"
              End="39.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="39.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="11.75,5,16,16"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 4]"
          TopLeft="384,52.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="31,0"
              Start="0,0"
              End="23.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="23.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 5]"
          TopLeft="827,151">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="60,0"
              Start="0,0"
              End="52.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="52.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 6]"
          TopLeft="945.5,174">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-205.5,40"
              Start="0,0"
              End="-205.5,32.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,16" />
                  <mssgle:CubicBezierSegment
                    Point1="0,16"
                    Point2="0,20"
                    Point3="-4,20" />
                  <mssgle:LineSegment
                    End="-201.5,20" />
                  <mssgle:CubicBezierSegment
                    Point1="-201.5,20"
                    Point2="-205.5,20"
                    Point3="-205.5,24" />
                  <mssgle:LineSegment
                    End="-205.5,32.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
  <DtsEventHandler
    design-time-name="Package.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="123,42"
          Id="Package.EventHandlers[OnError]\Error Log"
          TopLeft="60,60" />
        <NodeLayout
          Size="169,42"
          Id="Package.EventHandlers[OnError]\ETL Job Status Log"
          TopLeft="60,162" />
        <EdgeLayout
          Id="Package.EventHandlers[OnError].PrecedenceConstraints[Constraint]"
          TopLeft="121.5,102">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="23,60"
              Start="0,0"
              End="23,52.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,26" />
                  <mssgle:CubicBezierSegment
                    Point1="0,26"
                    Point2="0,30"
                    Point3="4,30" />
                  <mssgle:LineSegment
                    End="19,30" />
                  <mssgle:CubicBezierSegment
                    Point1="19,30"
                    Point2="23,30"
                    Point3="23,34" />
                  <mssgle:LineSegment
                    End="23,52.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>